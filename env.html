<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>.env & dotenv — Cours Express.js</title>
  <link rel="stylesheet" href="style.css"/><script src="script.js" defer></script>
</head>
<body>
<nav>
  <h1>Cours Express.js</h1>
  <ul>
    <li><a href="index.html">Introduction</a></li>
    <li><a href="server.html">Serveur</a></li>
    <li><a href="env.html">.env</a></li>
    <li><a href="db.html">MySQL</a></li>
    <li><a href="routes.html">Routes</a></li>
    <li><a href="controllers.html">Controllers</a></li>
    <li><a href="middleware.html">Middleware</a></li>
    <li><a href="api.html">API MVC</a></li>
    <li><a href="tests.html">Tests</a></li>
    <li><a href="projet.html">Projet</a></li>
  </ul>
</nav>

<div class="container">
  <h2>Variables d'environnement & sécurité</h2>

  <article>
    <h3>1) Exemple de fichier `.env`</h3>
    <p>Le fichier <code>.env</code> contient les variables sensibles et spécifiques à l'environnement (développement, test, production).</p>
    <pre><code>PORT=3000
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=example_password
DB_NAME=testdb
CORS_ORIGIN=http://localhost:5173
API_KEY=my-secret-api-key
NODE_ENV=development
API_PREFIX=/api
</code></pre>
    <p>Chaque variable est une paire clé/valeur. On peut ensuite les récupérer dans Node.js via <code>process.env.VARIABLE</code>.</p>
  </article>

  <article>
    <h3>2) Charger dotenv (ESM)</h3>
    <p>
      Dans Node.js moderne (ESM), on charge dotenv très simplement au début du fichier principal :
    </p>
    <pre><code>// server.js
import 'dotenv/config';  // Charge automatiquement les variables du fichier .env

import express from 'express';
const app = express();

// Exemple d'utilisation
const PORT = process.env.PORT ?? 3000;
app.listen(PORT, () => console.log(`Serveur démarré sur http://localhost:${PORT}`));
</code></pre>
    <p>
      Toutes les variables définies dans <code>.env</code> deviennent disponibles via <code>process.env</code>.
    </p>
  </article>

  <article>
    <h3>3) Sécurité : ne jamais committer `.env`</h3>
    <p>
      Pour éviter de divulguer vos clés et mots de passe, ajoutez <code>.env</code> dans <code>.gitignore</code> :
    </p>
    <pre><code># .gitignore
.env
node_modules/
</code></pre>
    <p>
      En production, utilisez les variables d'environnement du serveur ou CI/CD au lieu de stocker un fichier en clair.
    </p>
  </article>

  <article>
    <h3>4) Séparer les environnements</h3>
    <p>
      Il est courant d'avoir plusieurs fichiers de configuration selon l'environnement :
      <ul>
        <li><code>.env.development</code> pour le développement local</li>
        <li><code>.env.test</code> pour les tests automatisés</li>
        <li>Variables d'environnement du serveur pour la production</li>
      </ul>
      Avec <code>dotenv</code>, vous pouvez charger le fichier correspondant selon <code>NODE_ENV</code>.
    </p>
    <pre><code>import 'dotenv/config';
if (process.env.NODE_ENV === 'test') {
  import('dotenv/config').config({ path: '.env.test' });
}</code></pre>
  </article>

  <article>
    <h3>5) Bonnes pratiques</h3>
    <ul>
      <li>Ne stockez jamais de mots de passe ou clés API en clair dans le dépôt.</li>
      <li>Limitez l’accès au fichier `.env` en production via les permissions du système.</li>
      <li>Utilisez un préfixe pour toutes vos variables d’API (ex: <code>API_KEY</code>, <code>API_SECRET</code>).</li>
      <li>Documentez les variables nécessaires pour chaque environnement dans un README.</li>
    </ul>
  </article>

  <article>
    <h3>6) Exercice pratique</h3>
    <div class="exercise">
      1. Ajoute <code>API_PREFIX=/api</code> dans ton <code>.env</code>.<br/>
      2. Modifie <code>server.js</code> pour utiliser ce préfixe lors du montage des routes :
      <pre><code>import userRoutes from './routes/userRoutes.js';
app.use(process.env.API_PREFIX + '/users', userRoutes);</code></pre>
      3. Vérifie que tes routes sont accessibles via <code>/api/users</code>.
    </div>
  </article>
</div>
</body>
</html>
